import"./modulepreload-polyfill-B5Qt9EMX.js";const m=document.getElementById("cityInput"),i=document.getElementById("searchBtn"),d=document.getElementById("loading"),s=document.getElementById("error"),u=document.getElementById("result");function g(){d.classList.add("show"),s.classList.remove("show"),u.classList.remove("show"),i.disabled=!0}function l(){d.classList.remove("show"),i.disabled=!1}function a(t){s.textContent=t,s.classList.add("show"),u.classList.remove("show")}function p(t){document.getElementById("flag").textContent=t.flag,document.getElementById("cityName").textContent=t.city,document.getElementById("countryName").textContent=t.country,document.getElementById("currencyCode").textContent=t.currencyCode,document.getElementById("rateValue").textContent=`${t.rate} ₽`,u.classList.add("show"),s.classList.remove("show")}async function E(t){const n=`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(t)}&format=json&limit=1&accept-language=en`,e=await fetch(n,{headers:{"User-Agent":"CurrencyConverterApp/1.0"}});if(!e.ok)throw new Error("Не удалось найти город");const o=await e.json();if(o.length===0)throw new Error("Город не найден");return o[0]}async function I(t){const n=`https://restcountries.com/v3.1/name/${encodeURIComponent(t)}?fullText=true`,e=await fetch(n);if(!e.ok)throw new Error("Не удалось получить информацию о стране по названию");return(await e.json())[0]}async function C(t){const n=`https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/${t}.json`,e=await fetch(n);if(!e.ok)throw new Error("Не удалось получить курс валюты");const o=await e.json();if(!o[t]||!o[t].rub)throw new Error("Курс для этой валюты недоступен");return o[t].rub}async function y(){const t=m.value.trim();if(!t){a("Пожалуйста, введите название города");return}g();try{const n=await E(t),e=n.display_name.split(", "),o=e[e.length-1],h=n.name||e[0],r=await I(o);if(!r.currencies)throw new Error("Не удалось определить валюту для этой страны");const c=Object.keys(r.currencies)[0].toLowerCase(),w=Object.keys(r.currencies)[0];if(console.log("Код валюты:",c),c==="rub"){a("Этот город находится в России. Курс рубля к рублю = 1 ₽"),l();return}const f=await C(c);p({city:h,country:r.name.common,currencyCode:w,rate:f.toFixed(2),flag:r.flag})}catch(n){console.error("Ошибка:",n),a(n.message||"Произошла ошибка при получении данных")}finally{l()}}i.addEventListener("click",y);m.addEventListener("keypress",t=>{t.key==="Enter"&&y()});
